{
  "_id": "{{@ system @}}-vendor-collect",
  "namespaces": {
    "identity": ""
  },
  "source": {
    "dataset": "{{@ system @}}-business-collect",
    "type": "dataset"
  },
  "transform": [
    {
      "rules": {
        "default": [
          [
            "add",
            "::payload",
            [
              "dict",
              "query",
              [
                "concat",
                "query {  business(id: \"",
                "_S.node.id",
                "\") { id vendors { edges { node {id name business {id} address { addressLine1 addressLine2 city province { code name } country { code  } postalCode } firstName lastName displayId email mobile phone fax tollFree website internalNotes currency { code } createdAt modifiedAt isArchived } } } } }"
              ],
              "variables",
              {}
            ]
          ]
        ]
      },
      "type": "dtl"
    },
    {
      "id_expression": "{{ node.id }}",
      "operation": "get",
      "system": "{{@ system @}}",
      "type": "rest",
      "updated_expression": "{{ modifiedAt }}"
    },
    {
      "rules": {
        "customer": [
          [
            "copy",
            "*"
          ],
          [
            "add",
            "_id",
            "_S.id"
          ]
        ],
        "default": [
          [
            "create-child",
            [
              "apply",
              "customer",
              "_S.response.data.business.vendors.edges.node"
            ]
          ]
        ]
      },
      "type": "dtl"
    }
  ],
  "type": "pipe"
}